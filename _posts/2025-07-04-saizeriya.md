---
layout: post
title: サイゼリヤで1000円でおなかいっぱいになりたい
subtitle: ナップザック問題、動的計画法を用いて
mathjax: true
gh-repo: mikami1004/blog
gh-badge: [star, follow]
tags: [Programming]
---

# 前書き
ナップザック問題について調べていた時に面白い問題が出てきたので勉強がてら解いてみます。

# 問題
サイゼリヤのメニューを合計1000円以下になるように選んだときに、最大の総カロリーになるようなメニューの組み合わせを求めよ。<br>
先人たちはは重複なしで解いている人が多かったですが、今回は重複なしとありの２パターン求めてみようと思います。

# さあ、はじめるぞ
解く方針としては前書きにも述べたようにナップザック問題になるので、動的計画法で解いていこうと思います。ここで~~自分のために~~ナップザック問題、動的計画法についておさらいしておこうと思います。

### ナップザック問題とは
ナップザック問題とは以下のような問題です。<br>
> Nこの品物があり、各品物には**重さ**と**価値**が決まっている。これらの品物から**重さの総和がWを超えないように**選んだときの**価値の最大値**を求めよ。

解法としてまず思いつくのが全探索ですが、その計算量は$O(2^n)$となります。
[計算量の話](https://cppx.hatenablog.com/entry/2017/08/06/104144)や[【Python】AtcoderでTLEになる計算量の閾値を調べてみた 【PyPy】](https://rit-inc.hatenablog.com/entry/2021/12/13/180125)を見るとAtCoderでは$10^7$程度までの計算量には耐えうることがわかります。なので品物の数が少ない場合（23個以内）には耐えうるかと思いますが、それ以上になってしまうと計算が長くなってしまいます。<br>
まあ計算量が$O(2^n)$と指数関数的に増えてしまうので全探索は避けたほうが無難ですね。

そこで今回は動的計画法を使っていくことにします。

### 動的計画法とは
動的計画法とは、<br>
> 計算量が大きい問題を**小さな問題に部分化**し、それぞれの問題の計算結果を**表に記録**し、表から計算結果を参照しつつ問題を解く手法

です。言葉で言われてもよくわからないですよね。~~僕もよくわからない~~
皆さん「動的計画法とは」でググってくださいorz<br>
手を動かして理解したい方は[こちらの記事](https://qiita.com/drken/items/dc53c683d6de8aeacf5a)が参考になるかと思います。

(動的計画法について調べるとメモ化再帰についても出てくるけどこれらの違いがよくわかってないです...わかる方いたら教えてください m(_ _)m)

# いざ実践！
さて、今回の問題を解くためにまずサイゼリヤのメニューのデータが必要ですね。<br>
先人たちの努力を見てみると、メニュー表から手打ちしたり、既に存在するCSVファイルを用いたりしていますがメニュー改定により値段が変わっていたりします。最新のデータを使いたいですよね。<br>
そして手打ちはめんどくさい！楽したい！

そんな皆さんに朗報です。<br>
なんとですね、[こちらのサイト](https://allergy.saizeriya.co.jp/allergy)からスクレイピングをすることができます！うれしい！<br>
PythonでWebサイトのスクレイピングをする際、主に使われるのはBeautifulSoupやSeleniumだと思います。ですが今回の場合はもっと簡単にできるんですね。

このカロリーサイトはMaterial UIというもので構築されています。そして、内部的にAPIをたたいてデータを取得してサイトに表示しています。なのでその際に利用されているAPIエンドポイントを用いることで簡単にスクレイピングができるというわけです。<br>
気になる方は上記のリンクからアレルギー情報のサイトにアクセスし、開発者ツール->NetWorkのタブを開き、サイトの更新をしてみてください。<br>
view?lg=jaという名前のもののRequest URLにアクセスするとデータが取得できるのが確認できるかと思います。

以下がグランドメニューをスクレイピングするコードになります。データ形式はcsvでファイル名はsaizeriya_menu.csvとしています。
``` py
import requests
import pandas as pd

url = "https://allergy.saizeriya.co.jp/view?lg=ja"
resp = requests.get(url)
data = resp.json()["body"]

grand_menu = [item for item in data if item.get("category") == "グランド"]

# データ整形
df = pd.DataFrame(grand_menu)
df = df[["name", "includigTaxPrice", "calorie"]]
df.columns = ["商品名", "税込価格(円)", "カロリー(kcal)"]

# 保存
df.to_csv("saizeriya_menu.csv", index=False)
print(df.head())
```

保存されたcsvファイルを確認して、ドリンクバー以下のデータは使わないので消してしまいましょう。